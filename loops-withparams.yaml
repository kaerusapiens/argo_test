apiVersion: argoproj.io/v1alpha1
kind: Workflow
metadata:
  generateName: dag-withparams-example-
spec:
  entrypoint: dag-workflow
  templates:
    - name: dag-workflow
      dag:
        tasks:
          # ğŸ”¥ í¬ì¼“ëª¬ ë°ì´í„° ê°€ì ¸ì˜¤ê¸° (ë³‘ë ¬ ì‹¤í–‰)
          - name: fetch-pokemon
            template: fetch-data
            arguments:
              parameters:
                - name: pokemon
                  value: "{{item}}"
            withParam: '["Pikachu", "Charmander", "Squirtle"]'

          # ğŸ”¥ í¬ì¼“ëª¬ ë°ì´í„° ì²˜ë¦¬ (ë³‘ë ¬ ì‹¤í–‰)
          - name: process-pokemon
            dependencies: [fetch-pokemon]
            template: process-data
            arguments:
              parameters:
                - name: pokemon
                  value: "{{item}}"
            withParam: "{{tasks.fetch-pokemon.outputs.parameters.pokemon_output}}"

          # ğŸ‰ ìµœì¢… ìš”ì•½ ë‹¨ê³„
          - name: finalize
            dependencies: [process-pokemon]
            template: summary

    # ğŸ”¥ í¬ì¼“ëª¬ ë°ì´í„° ê°€ì ¸ì˜¤ê¸° ë‹¨ê³„
    - name: fetch-data
      inputs:
        parameters:
          - name: pokemon
      container:
        image: alpine
        command: [sh, -c]
        args:
          - |
            echo "Fetching data for {{inputs.parameters.pokemon}}"
            echo "{{inputs.parameters.pokemon}}" > /tmp/output.txt
      outputs:
        parameters:
          - name: pokemon_output
            valueFrom:
              path: /tmp/output.txt

    # ğŸ”¥ í¬ì¼“ëª¬ ë°ì´í„° ì²˜ë¦¬ ë‹¨ê³„
    - name: process-data
      inputs:
        parameters:
          - name: pokemon
      container:
        image: alpine
        command: [sh, -c]
        args:
          - "echo Processing {{inputs.parameters.pokemon}}"

    # ğŸ‰ ìµœì¢… ë‹¨ê³„
    - name: summary
      container:
        image: alpine
        command: [sh, -c]
        args:
          - "echo All PokÃ©mon processed! ğŸ‰"
